iw=innerWidth*devicePixelRatio,ih=innerHeight*devicePixelRatio,PRE=46,PATH='img/',LOAD=['pop/bg_draw','pop/bg_long','pop/bg_lucky','pop/bg_msg','pop/btn_close','pop/btn_info','pop/btn_submit','pop/cloud_0','pop/cloud_1','pop/draw','pop/tips','pop/title_mine','pop/title_msg','pop/title_rule','pop/title_will','pop/will','award','btn_into','btn_into_word','index/bg','index/bg_circle','index/btn_mine','index/btn_rule','index/btn_start','index/btn_will','index/cloud','index/man','index/title','index/tree_0','index/tree_1','index/vip','music_0','music_1'],LOAD_GAME=['gold','cloud_0','cloud_1','kill','p_0','p_1','p_3','p_j','p_d','line_0','line_1','line_2','line_3'];function Suit(a,b,c){var d=Math.ceil,e=a/b;a/=720,b=b/1135*ih,a=b*e>iw*a?iw*a:b*e,b=a/e,c.w=d(a),c.h=d(b)}function Gold(a,b){var c=Math.floor,d=this;a.gold=this,Suit(89,79,this);var e=c(2*Math.random());a['child_'+e].w<this.w&&(e=+!e),this.x=c(Math.random()*(a['child_'+e].w-this.w))+a['child_'+e].x,this.y=a.y-.8*this.h,this.area=e,this.Draw=function(){return!d.geted&&b.ctx.drawImage(b.img_gold,d.x,d.y,d.w,d.h)}}function Kill(a,b){var c=Math.floor,d=this;if(Suit(56,87,this),a.gold){for(var e=a.gold,f=a['child_'+e.area],g=[{x:f.x,w:e.x-f.x-this.w-e.w/2},{x:e.x+1.5*e.w,w:f.x+f.w-e.x-1.5*e.w},a['child_'+ +!e.area]],h=c(3*Math.random());g[h].w<this.w;)h=['',1,2,0][h+1];this.x=c(Math.random()*(g[h].w-this.w))+g[h].x}else{var h=c(2*Math.random());a['child_'+h].w<this.w&&(h=+!h),this.x=c(Math.random()*(a['child_'+h].w-this.w))+a['child_'+h].x}this.y=a.y-.8*this.h,this.Draw=function(){return b.ctx.drawImage(b.img_kill,d.x,d.y,d.w,d.h)}}function Cloud(a){var b=this;this.y=(clouds.length==cloud_max?ih-clouds_b:clouds_b*clouds.length)+2*clouds_b,this.random=Math.floor(Math.random()*(iw-cloud_b)),this.child_0={x:0,w:this.random},this.child_1={x:this.random+cloud_b,w:iw-this.random-cloud_b},cloud_num++,.6<Math.random()&&golds.push(new Gold(this,a)),Math.random()>4/cloud_num&&kills.push(new Kill(this,a)),this.Draw=function(){for(var c=b.child_0.w,d=0;0<c;d++)a.ctx.drawImage(a.img_cloud_0,c-cloud_size.w,b.y-cloud_y,cloud_size.w,cloud_size.h),c-=cloud_size.w/2;for(var e=b.child_1.x,d=0;e<iw;d++)a.ctx.drawImage(a.img_cloud_1,e,b.y-cloud_y,cloud_size.w,cloud_size.h),e+=cloud_size.w/2}}function Player(a){var b=Math.floor,c=this;this.img_data={0:{},1:{},3:{},j:{},d:{}},Suit(65,155,this.img_data[0]),Suit(102,155,this.img_data[1]),Suit(98,155,this.img_data[3]),Suit(152,109,this.img_data.j),Suit(187,157,this.img_data.d),this.img_data[2]=this.img_data[0],this.Jump=function(){b(c.vy)!=b(-fall_v)||(c.jumping=!0,c.jumping_max=!1,a.bgm&&a.music_j.play(),c.vy=-fall_v,jump_v=jump_max)},this.Choose=function(b){c.die&&'d'!=b||(c.w=c.img_data[b].w,c.h=c.img_data[b].h,c.img=a['img_p_'+b],'j'==c.type&&'j'!=b&&'d'!=b&&c.vy==-fall_v&&(c.y-=c.img_data[0].h-c.img_data.j.h),c.type=b)};var d,e;this.Run=function(){return'd'!=c.type&&c.Choose('j'==c.type||3==c.type?0:++c.type)},this.ToRun=function(){var a=Date.now();e||(e=a),a-e>=80?(c.Run(),e=a):(clearTimeout(d),d=setTimeout(c.Run,80))},this.Choose(3),this.x=this.w/2,this.y=100/1135*ih,this.vx=0,this.vy=player_v,this.Draw=function(){c.to_l&&(a.ctx.translate(iw,0),a.ctx.scale(-1,1)),a.ctx.drawImage(c.img,(c.to_l?iw-c.x:c.x)-c.w/2,c.y+=c.vy,c.w,c.h),c.to_l&&(a.ctx.translate(iw,0),a.ctx.scale(-1,1))}}function Line(a){var b=this,c={},d={};Suit(10,20,d),Suit(68,56,c);for(var e=20/1135*ih,f=[],g=(iw-2*d.w+c.w/5)/(.8*c.w),h=0;h<g;h++)f.push(h%3+1);var j=ih-e-d.h,k=ih-e/2-c.h,l=e/2;this.deadline_0=l+c.h/2,this.deadline_1=k+c.h/2;var m,n;this.Change=function(){return f.push(f.shift())},this.ToChange=function(){var a=Date.now();n||(n=a),a-n>=120?(b.Change(),n=a):(clearTimeout(m),m=setTimeout(b.Change,120))},this.Draw=function(){a.ctx.drawImage(a.img_line_0,0,j,d.w,d.h),a.ctx.translate(iw,0),a.ctx.scale(-1,1),a.ctx.drawImage(a.img_line_0,0,e,d.w,d.h),a.ctx.drawImage(a.img_line_0,0,j,d.w,d.h),a.ctx.translate(iw,0),a.ctx.scale(-1,1),f.forEach(function(b,e){return a.ctx.drawImage(a['img_line_'+b],d.w-c.w/10+.8*(e*c.w),l,c.w,c.h)}),f.forEach(function(b,e){return a.ctx.drawImage(a['img_line_'+b],d.w-c.w/10+.8*(e*c.w),k,c.w,c.h)}),b.ToChange()}}cloud_size={},Suit(156,80,cloud_size),cloud_max=4,cloud_b=140/720*iw,cloud_y=20/1135*ih,clouds_b=(ih+cloud_size.h)/(cloud_max-1),cloud_err=20/1135*ih,fall_v_source=2.4/1135*ih,player_v=6.2/1135*ih,player_vx=12/720*iw,jump_max=1.5/1135*ih,jump_v_up=.08/1135*ih,jump_v_down=.13/1135*ih,new App({data:{error:'',rule:'',awards:'',name:'',phone:'',address:'',saved:'',score:0},watch:{load:function load(a){a==PRE&&this.Init()}},methods:{Init:function Init(){var a=this;KWhale.Loading.Stop(function(){a.page='index',setTimeout(function(){a.alert=_wel_simple,a.cando=!0},3600)});var b=$id('game');b.width=iw,b.height=ih,this.ctx=b.getContext('2d'),this.img_p_2=this.img_p_0,this.p=new Player(this),$id('game').addEventListener('click',function(){return a.p.Jump()}),window.addEventListener('deviceorientation',function(b){var c=Math.abs(b.gamma)/10;a.p.vx=(6<c?6:c)/6*player_vx,0<b.gamma?(a.p.to_r=!0,a.p.to_l=!1):(a.p.to_l=!0,a.p.to_r=!1)})},Rule:function Rule(){this.cando&&(this.ralert='rule')},Mine:function Mine(){this.cando&&(this.ralert='mine')},ClickStart:function ClickStart(){this.cando&&(this.first?this.ralert='tips':this.StartGame())},StartGame:function StartGame(){this.going||(this.going=!0,this.Reset(),this.page='game',this.Run())},HowClose:function HowClose(){this.first=!1,this.RalertClose(),this.StartGame()},WillCome:function WillCome(){this.cando&&(this.ralert='will')},Into:function Into(){this.alert='\u70B9\u51FB\u6B64\u5904\u539F\u4E3A\u6253\u5F00\u5916\u90E8\u94FE\u63A5'},Submit:function Submit(){this.name?this.phone?this.address?(this.alert='\u4FE1\u606F\u63D0\u4EA4\u6210\u529F',this.saved=!0):Toast('\u8BF7\u586B\u5199\u4F60\u7684\u6536\u8D27\u5730\u5740'):Toast('\u8BF7\u586B\u5199\u4F60\u7684\u624B\u673A\u53F7\u7801'):Toast('\u8BF7\u586B\u5199\u4F60\u7684\u59D3\u540D')},ReStart:function ReStart(){this.RalertClose(),this.StartGame()},Draw:function Draw(){this.awards=[{}],this.ralert='lucky'},RalertClose:function RalertClose(){this.ralert='lucky'==this.ralert&&'index'==this.page?'mine':''},AlertClose:function AlertClose(){'\u4FE1\u606F\u63D0\u4EA4\u6210\u529F'==this.alert&&this.RalertClose(),'game'==this.page&&(this.page='index'),this.alert=''},Reset:function Reset(){fall_v=0,this.score=0,golds=[],kills=[],clouds=[],cloud_num=0,setTimeout(function(){return fall_v=fall_v_source},1600);for(var a=0;a<cloud_max;a++)clouds.push(new Cloud(this));this.p=new Player(this),this.line=new Line(this)},Run:function Run(){this.ctx.clearRect(0,0,iw,ih),this.Calc(),this.p.Draw(),golds.forEach(function(a){return a.Draw()}),kills.forEach(function(a){return a.Draw()}),clouds.forEach(function(a){return a.Draw()}),this.line.Draw(),this.running=requestAnimationFrame(this.Run)},PointCalc:function PointCalc(c,a,b){return c<b&&b<a},Calc:function Calc(){var a,b,c=this,d=this.p,e=0;fall_v=fall_v>=1.6*fall_v_source?1.6*fall_v_source:fall_v_source*(1+.06*(cloud_num-cloud_max)),clouds.forEach(function(a,b){a.y-=fall_v,!d.jumping&&(d.x-d.w/2==iw||d.x==-d.w/2||c.PointCalc(a.y,a.y+cloud_err,d.y+d.h)&&(c.PointCalc(a.child_0.x,a.child_0.x+a.child_0.w-d.w/2,d.x-d.w/2)||c.PointCalc(a.child_0.x+d.w/2,a.child_0.x+a.child_0.w,d.x+d.w/2)||c.PointCalc(a.child_1.x,a.child_1.x+a.child_1.w-d.w/2,d.x-d.w/2)||c.PointCalc(a.child_1.x+d.w/2,a.child_1.x+a.child_1.w,d.x+d.w/2)||c.PointCalc(d.x-d.w/2,d.x+d.w/2,a.child_0.x)||c.PointCalc(d.x-d.w/2,d.x+d.w,a.child_0.x+a.child_0.w)||c.PointCalc(d.x,d.x+d.w/2,a.child_1.x)||c.PointCalc(d.x-d.w/2,d.x+d.w/2,a.child_1.x+a.child_1.w)))?d.vy=-fall_v:++e,a.y<-cloud_size.h&&(clouds[b]=new Cloud(c))}),e!=cloud_max||d.jumping||(d.vy=player_v),d.vy==-fall_v?d.ToRun():d.Choose(3),d.jumping&&(d.Choose('j'),d.jumping_max?(d.vy+=jump_v+=jump_v_up,d.vy>player_v&&(d.jumping=!1)):(d.vy-=jump_v-=jump_v_down,0>jump_v&&(d.jumping_max=!0))),golds.forEach(function(b,e){b.y-=fall_v,!b.geted&&c.PointCalc(b.y,b.y+b.h,d.y+.9*d.h)&&(c.PointCalc(b.x,b.x+b.w,d.x+.4*d.w)||c.PointCalc(b.x,b.x+b.w,d.x-.4*d.w))&&(b.geted=!0,c.score++),(b.geted||b.y<-b.h)&&(a=e)}),a!==void 0&&golds.splice(a,1),kills.forEach(function(a,e){a.y-=fall_v,!c.p.die&&c.PointCalc(a.y,a.y+a.h,d.y+.9*d.h)&&(c.PointCalc(a.x,a.x+a.w,d.x+.4*d.w)||c.PointCalc(a.x,a.x+a.w,d.x-.4*d.w))&&c.GameOver(),a.y<-a.h&&(b=e)}),b!==void 0&&kills.splice(b,1),(d.y<this.line.deadline_0||d.y+d.h>this.line.deadline_1)&&this.GameOver(),d.to_l?d.x-=d.vx:d.x+=d.vx,d.vx>player_vx?d.vx=player_vx:d.vx<-player_vx&&(d.vx=-player_vx),d.x-d.w/2>iw?d.x=-d.w/2:d.x<-d.w/2&&(d.x=iw+d.w/2)},GameOver:function GameOver(){var a=this;this.p.die||(this.going=!1,this.p.die=!0,this.p.Choose('d'),setTimeout(function(){return cancelAnimationFrame(a.running)}),this.awards.length?this.alert='\u6E38\u620F\u7ED3\u675F':this.ralert='draw')},Info:function Info(){this.ralert='lucky'}},created:function created(){var a=this;this._isMobile&&(LOAD.forEach(function(b){var c=new Image;c.onload=function(){return++a.load},c.onerror=function(){return a.error='\u8D44\u6E90\u52A0\u8F7D\u5931\u8D25\uFF1A'+b},c.src=''+PATH+b+'.png'}),LOAD_GAME.forEach(function(b){a['img_'+b]=new Image,a['img_'+b].onload=function(){return++a.load},a['img_'+b].onerror=function(){return a.error='\u8D44\u6E90\u52A0\u8F7D\u5931\u8D25\uFF1A'+b},a['img_'+b].src=PATH+'game/'+b+'.png'}),this.InitBgm('music/bgm.mp3'),this.music_j=new Audio,this.music_j.src='music/jump.mp3',this.first=!0,this.rule=_rule_simple)},mounted:function mounted(){this._CheckMobile()&&(this.page='loading',KWhale.Loading.Init({id:'loading',width:5,color:'#fff',logo:PATH+'logo.png'}))}});