iw=innerWidth*devicePixelRatio,ih=innerHeight*devicePixelRatio,PRE=15,PATH='img/',LOAD=['pop/bg_msg','pop/close','pop/bg_confirm','pop/btn_sure','pop/btn_cancel','btn_back','btn_continue','btn_del','btn_hub','btn_submit','btn_upload','start','title','demo'],LOAD2=[0,1,2,3,4,5,6,7],ITEM=[246,41,126,235,260,197,258,247];function Suit(a,b){var c=Math.ceil,d=a/b;return a/=720,b=b/1135*ih,a=b*d>iw*a?iw*a:b*d,b=a/d,{w:c(a),h:c(b)}}new App({data:{error:'',doing:'',confirm:'',loading_dot:0,create_img:'',create_hub:''},watch:{load:function load(a){a==PRE&&this.Init()}},methods:{Init:function Init(){var a=this;setTimeout(function(){clearInterval(a.load_dot),a.page='index',setTimeout(function(){a.cando=!0,a.alert=_wel_simple},2400)},2e3<new Date-this.load_time?0:2e3)},Start:function Start(){this.cando&&(this.ClearCanvas(),this.page='upload')},InitCanvas:function InitCanvas(){function a(a){if(app.focus_item)if(a=a.touches,2==a.length){app.focus_item.stopDrag();var b=d(a[0].stageY-a[1].stageY,a[0].stageX-a[1].stageX);app.focus_item.rotation+=180/Math.PI*(b-h);var f=c(a),i=.01*(f-g),j=app.focus_item.scaleX+i,k=app.focus_item.scaleY+i;app.focus_item.scaleX=j<l?l:3<j?3:j,app.focus_item.scaleY=k<l?l:3<k?3:k,g=f,h=b}else 1==a.length&&app.focus_item.startDrag()}function b(){Laya.stage.off(Laya.Event.MOUSE_MOVE,this,a)}function c(a){var b=a[0].stageX-a[1].stageX,c=a[0].stageY-a[1].stageY;return Math.sqrt(b*b+c*c)}var d=Math.atan2,e=this;this.upload_img=new Image,this.upload_img.onload=function(){var a=new Laya.Sprite,b=e.upload_img.width,c=e.upload_img.height;if(b/c<720/1135)var d=e.mask.h,f=b/c*d,g=(e.stage.width-f)/2,h=e.mask.y;else var f=e.mask.w,d=c/b*f,g=e.mask.x,h=.35*e.stage.height+.15*e.mask.h-d/2;a.graphics.drawTexture(new Laya.Texture(e.upload_img),g,h,f,d),e.stage.addChild(a),e.$wait.over(),e.page='create'},Laya.Browser.container=$id('create_box'),Laya.init(iw,ih,Laya.WebGL);var f=LOAD2.map(function(a){return PATH+'create/'+a+'.png'}).concat(PATH+'bor.png');Laya.loader.load(f,Laya.Handler.create(this,function(){return e.load++}));var g,h,i=new Laya.Sprite,j=Suit(648,1021.5),k=this.stage=Laya.stage;i.graphics.drawRect(0,0,j.w,j.h,'#fff'),i.pos((k.width-j.w)/2,.35*(k.height-j.h)),k.mask=i,this.mask={x:i.x,y:i.y,w:j.w,h:j.h},k.bgColor='#444';var l=.4;k.on(Laya.Event.MOUSE_UP,this,b),k.on(Laya.Event.MOUSE_OUT,this,b),k.on(Laya.Event.MOUSE_DOWN,this,function(b){app.focus_item&&(b=b.touches,2==b.length?(app.focus_item.stopDrag(),h=d(b[0].stageY-b[1].stageY,b[0].stageX-b[1].stageX),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,a),g=c(b)):1==b.length&&app.focus_item.startDrag())})},ClearCanvas:function ClearCanvas(){this.stage.removeChildren();var a=new Laya.Sprite,b=Suit(648,1021.5);a.graphics.drawRect(0,0,b.w,b.h,'#fff'),a.pos((this.stage.width-b.w)/2,.35*(this.stage.height-b.h)),this.stage.addChild(a);for(var c,b=Suit(115.2,115.2),d=0;4>d;d++)c=new Laya.Sprite,c.loadImage(PATH+'bor.png',0,0,b.w,b.h),c.zOrder=1,c.rotation=90*d,c.pivot(b.w/2,b.h/2),0==d?c.pos(this.mask.x+b.w/2,this.mask.y+b.h/2):1==d?c.pos(this.mask.x+this.mask.w-b.w/2,this.mask.y+b.h/2):2==d?c.pos(this.mask.x+this.mask.w-b.w/2,this.mask.y+this.mask.h-b.h/2):3==d&&c.pos(this.mask.x+b.w/2,this.mask.y+this.mask.h-b.h/2),this.stage.addChild(c)},AddElement:function AddElement(a){var b=Suit(333,ITEM[a]),c=new Laya.Sprite;c.loadImage(PATH+'create/'+a+'.png',0,0,b.w,b.h),c.pivot(b.w/2,b.h/2),c.pos(this.stage.width/2,.35*this.stage.height),c.on(Laya.Event.MOUSE_DOWN,this,function(a){1==a.touches.length&&(app.focus_item=c)}),this.focus_item=c,this.stage.addChild(c),this.doing=!0},DelElement:function DelElement(){this.focus_item&&(this.stage.removeChild(this.focus_item),this.focus_item=null)},ShowCreateHub:function ShowCreateHub(){this.doing=!1},ToUpload:function ToUpload(){this.confirm='\u786E\u5B9A\u8981\u91CD\u65B0\u9009\u62E9\u7167\u7247\u5417',this.confitm_todo='BackToUpload'},BackToUpload:function BackToUpload(){this.page='upload',this.doing=!1,this.ClearCanvas()},ToSubmit:function ToSubmit(){this.confirm='\u786E\u5B9A\u8981\u751F\u6210\u5417',this.confitm_todo='Submit'},Upload:function Upload(a){var b=this;if(a=a.target,a.files[0]){this.$wait('\u6B63\u5728\u5904\u7406');var c=new FileReader;c.onload=function(){b.upload_img.src=c.result,a.form.reset()},c.readAsDataURL(a.files[0])}},Submit:function Submit(){this.$wait('\u6B63\u5728\u751F\u6210');var a=document.createElement('canvas');a.width=720,a.height=1135;var b=a.getContext('2d'),c=this.stage.drawToCanvas(this.stage.width,this.stage.height,0,0);b.drawImage(c._canvas,this.mask.x,this.mask.y,this.mask.w,this.mask.h,0,0,720,1135),this.create_img=a.toDataURL('png'),this.$wait.over(),this.page='end'},SureConfirm:function SureConfirm(){this.ConfirmClose(),this[this.confitm_todo]()},ConfirmClose:function ConfirmClose(){this.confirm=''}},created:function created(){var a=this;this._isMobile&&(LOAD.forEach(function(b){var c=new Image;c.onload=function(){return++a.load},c.onerror=function(){return a.error='\u8D44\u6E90\u52A0\u8F7D\u5931\u8D25\uFF1A'+b},c.src=''+PATH+b+'.png'}),this.create_hub=LOAD2)},mounted:function mounted(){var a=this;this._CheckMobile()&&(InitContact(),this.load_time=new Date,this.page='loading',this.load_dot=setInterval(function(){return a.loading_dot=++a.loading_dot%4},500),this.InitCanvas())}});