iw=innerWidth*devicePixelRatio,ih=innerHeight*devicePixelRatio,PRE=23,PATH='img/',LOAD=['game/block','game/btn_start','game/hd','game/score','index/address','index/belt','index/bottom_l','index/bottom_r','index/macao','index/man','index/start','index/time','index/title','index/word','logo_bottom','pop/bg_msg','pop/btn_close','pop/how_1','pop/how_2','pop/title_end','pop/title_how','pop/title_msg'],LOAD2=['mask','hole','pile','hit'],piles=[],hole_size=Suit(180,64),pile_size=Suit(108,188),mask_size=Suit(180,190),hit_size=Suit(183,124),core_size=Suit(630,650),core_size.xb=Math.ceil((core_size.w-3*mask_size.w)/2),core_size.yh=Math.ceil(core_size.h/3),core_size.yb=Math.ceil((core_size.yh-mask_size.h)/2);function Suit(a,b){var c=Math.ceil,d=a/b;return a/=720,b=b/1135*ih,a=b*d>iw*a?iw*a:b*d,b=a/d,{w:c(a),h:c(b)}}function Pile(a){var b=this,c=this,d=new Laya.Sprite,e=new Laya.Sprite,f=new Laya.Sprite,g=new Laya.Sprite;this.pile=new Laya.Sprite,e.loadImage(PATH+'game/hole.png',0,0,hole_size.w,hole_size.h),f.loadImage(PATH+'game/mask.png',0,0,mask_size.w,mask_size.h),g.loadImage(PATH+'game/hit.png',0,0,hit_size.w,hit_size.h),this.pile.loadImage(PATH+'game/pile.png',0,0,pile_size.w,pile_size.h),d.mask=f;var h=a%3;d.x=mask_size.w*h+core_size.xb*h;var i=Math.floor(a/3);d.y=core_size.yh*i+core_size.yb*i,e.y=mask_size.h-hole_size.h,g.y=.1*mask_size.h,this.pile.x=.656*mask_size.w-pile_size.w/2,this.pile.y=mask_size.h,this.pile.on(Laya.Event.MOUSE_DOWN,this,function(a){1==a.touches.length&&c.Hit()}),d.addChild(e),d.addChild(this.pile),app.game_core.addChild(d),this.Show=function(){b.showed||(b.showed=!0,Laya.Tween.to(b.pile,{y:mask_size.h-pile_size.h+6*devicePixelRatio},400,null,Laya.Handler.create(b,function(){b.hited=!1,b.can_hit=!0,b.timer=setTimeout(function(){return b.Hide()},600)})))},this.Hide=function(){b.can_hit=!1,Laya.Tween.to(b.pile,{y:mask_size.h},400,null,Laya.Handler.create(b,function(){return b.showed=!1}))},this.Hit=function(){b.can_hit&&app.playing&&!b.hited&&(b.hited=!0,b.can_hit=!1,d.addChild(g),clearTimeout(b.timer),setTimeout(function(){b.Hide(),d.removeChild(g)},300),app.score++)}}new App({data:{error:'',time:0,score:0,playing:''},watch:{load:function load(a){a==PRE&&this.Init()}},computed:{progress:function progress(){return 100*(this.load/PRE)+'%'}},methods:{Init:function Init(){var a=this;setTimeout(function(){a.page='index',setTimeout(function(){a.cando=!0,a.alert=_wel},2e3)},1e3<new Date-this.load_time?0:1e3)},InitCanvas:function InitCanvas(){var a=this;for(Laya.Browser.container=$id('game_area'),Config.isAlpha=!0,Laya.init(iw,ih,Laya.WebGL),Laya.loader.load(LOAD2.map(function(a){return PATH+'game/'+a+'.png'}),Laya.Handler.create(this,function(){return a.load++})),this.stage=Laya.stage,this.stage.bgColor='none',this.game_core=new Laya.Sprite,this.game_core.w=core_size.w,this.game_core.h=core_size.h,this.game_core.x=(iw-core_size.w)/2,this.game_core.y=(ih-core_size.h)/2,this.stage.addChild(this.game_core);9>piles.length;)piles.push(new Pile(piles.length))},ToGame:function ToGame(){this.cando&&(this.page='game',this.ralert='how')},StartGame:function StartGame(){var a=Math.floor,b=this;this.playing||(this.time=30,this.score=0,this.playing=!0,this.time_timer=setInterval(function(){b.time?b.time--:(clearInterval(b.time_timer),b.GameOver())},1e3),piles[a(9*Math.random())].Show(),this.game_timer=setInterval(function(){b.time?piles[a(9*Math.random())].Show():clearInterval(b.game_timer)},500))},GameOver:function GameOver(){piles.forEach(function(a){return a.Hide()}),this.playing=!1,this.ralert='end'}},created:function created(){var a=this;this._isMobile&&LOAD.forEach(function(b){var c=new Image;c.onload=function(){return++a.load},c.onerror=function(){return a.error='\u8CC7\u6E90\u52A0\u8F09\u5931\u6557\uFF1A'+b},c.src=''+PATH+b+'.png'})},mounted:function mounted(){this._CheckMobile()&&(InitContact(),this.load_time=new Date,this.page='loading',this.InitCanvas())}});