iw=innerWidth*devicePixelRatio,ih=innerHeight*devicePixelRatio,PRE=23,PATH='img/',LOAD=['pop/bg_msg','pop/btn_close','index/bg','index/earth','game/bg','game/earth','index/cat','index/flower_l','index/flower_r','index/start','music_0','music_1','pop/tips','index/title'];function Suit(a,b,c){var d=Math.ceil,e=a/b;return a/=720,b=b/1135*ih,a=b*e>iw*a?iw*a:b*e,b=a/e,c?void(c.w=d(a),c.h=d(b)):{w:d(a),h:d(b)}}function Cat(a){var b=this;Suit(112,156,this);var c=-ih/65;this.x=iw/2-this.w/2,this.y=ih-this.h,this.vx=0,this.vy=c,this.img=a.img_cat,this.Jump=function(){b.vy=c,b.img=a.img_cat_jump,a.bgm&&a.music_j.play(),setTimeout(function(){return b.img=a.img_cat},200)},this.Draw=function(){return a.ctx.drawImage(b.img,b.x,b.y,b.w,b.h)}}function Gold(a,b){var c=this;this.x=a.x,this.y=a.y;var d={offset:Suit(74,80),Draw:function Draw(){b.ctx.drawImage(b.img_km,this.x,this.y,this.w,this.h)}},e={offset:Suit(130,40),text:cloud_num/5,Draw:function Draw(){b.ctx.font='italic '+20*iw/720+'px sans-serif',b.ctx.fillText('KM',this.x+b.km_width,this.y),b.ctx.font='italic '+32*iw/720+'px sans-serif',b.ctx.fillText(this.text,this.x,this.y)}},f={offset:Suit(-6,66),img:b['img_g'+Math.ceil(5*Math.random())],Draw:function Draw(){b.ctx.drawImage(this.img,this.x,this.y,this.w,this.h)}};Suit(107,104,d),Suit(100,100,f),this.offset=d.h,this.w=a.w,this.run=a.run,this.vx=2,this.Draw=function(){[d,e,f].forEach(function(a){a.x=c.x+a.offset.w,a.y=c.y-a.offset.h,a.Draw()})}}function Cloud(a){var b=this;Suit(191,70,this),this.x=Math.random()*(iw-this.w),this.y=clouds.length==cloud_max?0:ih/cloud_max*clouds.length,this.vx=2,this.run=Math.random()>.8/a.score,this.Draw=function(){return a.ctx.drawImage(a.img_cloud,b.x,b.y,b.w,b.h)},cloud_num+=1,cloud_num%5||golds.push(new Gold(this,a))}function Reset(a){golds=[],clouds=[],cloud_num=0,a.score=0;for(var b=0;b<cloud_max;b++)clouds.push(new Cloud(a));a.cat=new Cat(a)}g=ih/3e3,cloud_max=4,cat_vx=12/720*iw,new App({data:{error:'',score:0},watch:{load:function load(a){a==PRE&&this.Init()}},filters:{fixed:function fixed(a){return a.toFixed(1)}},methods:{Init:function Init(){var a=this;Reset(this),window.addEventListener('deviceorientation',function(b){var c=Math.abs(b.gamma)/10;a.cat.vx=(6<c?6:c)/6*cat_vx,a.cat.vx>cat_vx?a.cat.vx=cat_vx:a.cat.vx<-cat_vx&&(a.cat.vx=-cat_vx),0<b.gamma?(a.cat.to_r=!0,a.cat.to_l=!1):(a.cat.to_l=!0,a.cat.to_r=!1)}),KWhale.Loading.Stop(function(){a.page='index',setTimeout(function(){a.cando=!0,a.alert=_wel_simple},3e3)})},Start:function Start(){if(this.cando)if(this.ctx.clearRect(0,0,iw,ih),this.page='game',this.first)this.ralert='tips';else{if(this.starting)return;this.starting=!0,Reset(this),setTimeout(this.Run,600),this.music_j.play()}},GameStart:function GameStart(){this.starting||(this.starting=!0,this.RalertClose(),this.Run(),this.first=!1,this.music_j.play())},Run:function Run(){this.ctx.clearRect(0,0,iw,ih),this.Calc(),clouds.forEach(function(a){return a.Draw()}),golds.forEach(function(a){return a.Draw()}),this.cat.Draw(),this.running=requestAnimationFrame(this.Run)},Calc:function Calc(){var a=this,b=this.cat;b.to_l?b.x-=b.vx:b.x+=b.vx,b.y+b.h>ih&&!b.jumped&&b.Jump(),b.y>ih&&!b.isDead&&this.GameOver(),b.x>iw?b.x=-b.w:b.x<-b.w&&(b.x=iw),golds.forEach(function(a){a.run&&((0>a.x||a.x+a.w>iw)&&(a.vx*=-1),a.x+=a.vx)}),clouds.forEach(function(a){a.run&&((0>a.x||a.x+a.w>iw)&&(a.vx*=-1),a.x+=a.vx)}),b.y>=ih/2-b.h/2?(b.y+=b.vy,b.vy+=g):(golds.forEach(function(a,c){0>b.vy&&(a.y-=b.vy),a.y-a.offset>ih&&golds.splice(c,1)}),clouds.forEach(function(c,d){0>b.vy&&(c.y-=b.vy),c.y>ih&&(clouds[d]=new Cloud(a))}),b.vy+=g,0<=b.vy&&(b.y+=b.vy,b.vy+=g)),0<b.vy&&clouds.forEach(function(c){b.x+b.w/2<c.x+c.w&&b.x+b.w/2>c.x&&b.y+b.h>c.y+4&&b.y+b.h<c.y+c.h&&(b.jumped=!0,!c.kissed&&(c.kissed=!0,a.score+=.2),b.Jump())})},GameOver:function GameOver(){this.starting=!1,this.cat.isDead=!0,this.cat.y>ih&&setTimeout(this.Stop),this.alert='\u6E38\u620F\u5DF2\u7ED3\u675F'},Stop:function Stop(){cancelAnimationFrame(this.running)},AlertClose:function AlertClose(){'game'==this.page&&(this.page='index'),this.alert=''}},created:function created(){var a=this;this._isMobile&&(['cat','cat_jump','km','cloud','g1','g2','g3','g4','g5'].forEach(function(b){a['img_'+b]=new Image,a['img_'+b].onload=function(){return++a.load},a['img_'+b].onerror=function(){return a.error='\u8D44\u6E90\u52A0\u8F7D\u5931\u8D25\uFF1A'+b},a['img_'+b].src=PATH+'game/'+b+'.png'}),LOAD.forEach(function(b){var c=new Image;c.onload=function(){return++a.load},c.onerror=function(){return a.error='\u8D44\u6E90\u52A0\u8F7D\u5931\u8D25\uFF1A'+b},c.src=''+PATH+b+'.png'}),this.InitBgm('music/bgm.mp3'),this.music_j=new Audio,this.music_j.preload=!0,this.music_j.src='music/jump.mp3',this.first=!0)},mounted:function mounted(){this._CheckMobile()&&(InitContact(),this.page='loading',KWhale.Loading.Init({id:'loading',width:3,color:'#fff',logo:PATH+'logo.png'}),this.canvas=$id('game'),this.canvas.width=iw,this.canvas.height=ih,this.ctx=this.canvas.getContext('2d'),this.ctx.textAlign='right',this.ctx.fillStyle='#552435',this.ctx.font='italic '+20*iw/720+'px sans-serif',this.km_width=this.ctx.measureText('KM').width)}});